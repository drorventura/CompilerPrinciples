
STRING_TO_SYMBOL:

PUSH(FP);
MOV(FP, SP);
PUSH(R1);
PUSH(R2);
PUSH(R3);
PUSH(R4);
PUSH(R5);
PUSH(R6);
PUSH(R7);
PUSH(R8);

MOV(R0, FPARG(2));

CMP(IND(R0),T_STRING);
JUMP_NE(STRING_SYMBOL_FINAL_END);

MOV(R6,R0) 


MOV(R1,10);
MOV(R2,ADDR(0));


STRING_SYMBOL_LOOP_START:
CMP(R1,R2);
JUMP_GE(STRING_SYMBOL_NOT_FOUND);

CMP(IND(R1),T_SYMBOL);
JUMP_NE(ADD_PLUS_ONE);

MOV(R7,INDD(R1,1));
MOV(R7,IND(R7));
CMP(IND(R7),T_STRING);
JUMP_NE(ADD_PLUS_ONE);

MOV(R8,INDD(R7,1));
MOV(R4,0);


INSIDE_LOOP:
CMP(R4,INDD(R6,1));
JUMP_GE(STRING_SYMBOL_FINAL_END);

CMP(INDD(R7,2+R4),INDD(R6,2+R4));

JUMP_NE(ADD_PLUS_ONE);


ADD(R4,1);
JUMP(INSIDE_LOOP);



ADD_PLUS_ONE:
MOV(R4,0);
ADD(R1,1);
JUMP(STRING_SYMBOL_LOOP_START);

STRING_SYMBOL_NOT_FOUND: 

PUSH(2);
CALL(MALLOC);
DROP(1); 
MOV(IND(R0),R6);
MOV(INDD(R0,1),0);

MOV(R5,R0);
PUSH(2);
CALL(MALLOC);
DROP(1);
MOV(IND(R0),368031);
MOV(INDD(R0,1),R5);
JUMP(STRING_SYMBOL_END);

STRING_SYMBOL_FINAL_END: 
MOV(R0,R1);
STRING_SYMBOL_END : 
POP(R8);
POP(R7);
POP(R6);
POP(R5);
POP(R4);
POP(R3);
POP(R2);
POP(R1);
MOV(SP, FP);
POP(FP);
RETURN;
